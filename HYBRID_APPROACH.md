# üéØ –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥: ML + Rule Engine

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  –§–∏—á–∏    ‚îÇ (50 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤)
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ                           ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ML-–º–æ–¥–µ–ª—å  ‚îÇ      ‚îÇ  Rule Engine   ‚îÇ
‚îÇ (CatBoost) ‚îÇ      ‚îÇ  (8 –ø—Ä–∞–≤–∏–ª)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ                          ‚îÇ
    ‚îÇ –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å: 0.65       ‚îÇ –ë–∞–ª–ª—ã: 45
    ‚îÇ                          ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ –ö–æ–º–±–∏–Ω–∞—Ü–∏—è  ‚îÇ
      ‚îÇ (–≤–∑–≤–µ—à–µ–Ω–Ω–∞—è)‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ  –ü–†–û–í–ï–†–ò–¢–¨  ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîß –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. ML-–º–æ–¥–µ–ª—å (–æ—Å–Ω–æ–≤–Ω–æ–π —Å–ª–æ–π)
- **CatBoost** —Å 50 –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏
- **ROC-AUC: 0.995**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –¥–∞–Ω–Ω—ã—Ö

### 2. Rule Engine (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–ª–æ–π)
- **8 –ø—Ä–∞–≤–∏–ª** –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
- –ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è –ª–æ–≥–∏–∫–∞
- –õ–µ–≥–∫–æ –æ–±—ä—è—Å–Ω–∏—Ç—å —Ä–µ–≥—É–ª—è—Ç–æ—Ä—É

### 3. –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
```python
combined_score = 0.7 * ml_probability + 0.3 * (rule_score / 100)

if combined_score >= 0.8 OR rule_score >= 50:
    ‚Üí –ë–õ–û–ö–ò–†–û–í–ê–¢–¨
elif combined_score >= 0.3 OR rule_score >= 20:
    ‚Üí –ü–†–û–í–ï–†–ò–¢–¨
else:
    ‚Üí OK
```

## üìã –ü—Ä–∞–≤–∏–ª–∞ (Rule Engine)

| ID | –ü—Ä–∞–≤–∏–ª–æ | –ë–∞–ª–ª—ã | –ü—Ä–∏–º–µ—Ä |
|----|---------|-------|--------|
| **R1** | –°–∫–∞—á–æ–∫ —Å—É–º–º—ã (>5x —Å—Ä–µ–¥–Ω–µ–π) | +30 | 100,000‚Ç∏ –ø—Ä–∏ —Å—Ä–µ–¥–Ω–µ–π 8,000‚Ç∏ |
| **R2** | Velocity (<10 –º–∏–Ω –º–µ–∂–¥—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏) | +25 | 3 –ø–µ—Ä–µ–≤–æ–¥–∞ –∑–∞ 5 –º–∏–Ω—É—Ç |
| **R3** | –ù–æ—á–Ω–æ–π –ø–µ—Ä–µ–≤–æ–¥ (–∫–ª–∏–µ–Ω—Ç –æ–±—ã—á–Ω–æ –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω) | +20 | –ü–µ—Ä–µ–≤–æ–¥ –≤ 2:00, –æ–±—ã—á–Ω–æ —Å–ø–∏—Ç |
| **R4** | –ù–æ–≤—ã–π –ø–æ–ª—É—á–∞—Ç–µ–ª—å + –∫—Ä—É–ø–Ω–∞—è —Å—É–º–º–∞ | +25 | –ü–µ—Ä–≤—ã–π –ø–µ—Ä–µ–≤–æ–¥ 50,000‚Ç∏ |
| **R5** | –ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∞—è –∞–Ω–æ–º–∞–ª–∏—è (Z-score >2) | +20 | –•–∞–æ—Ç–∏—á–Ω—ã–µ –ª–æ–≥–∏–Ω—ã |
| **R6** | –í—Å–ø–ª–µ—Å–∫ —á–∞—Å—Ç–æ—Ç—ã –≤—Ö–æ–¥–æ–≤ | +20 | 18 –≤—Ö–æ–¥–æ–≤ –≤–º–µ—Å—Ç–æ –æ–±—ã—á–Ω—ã—Ö 3 |
| **R7** | –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ (–º–µ–ª–∫–∏–µ –ø–µ—Ä–µ–≤–æ–¥—ã) | +15 | –°–µ—Ä–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –ø–æ 9,900‚Ç∏ |
| **R8** | –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç + –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å | +15 | <5 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π + –∞–Ω–æ–º–∞–ª–∏–∏ |

**–ü–æ—Ä–æ–≥–∏:**
- ‚â•50 –±–∞–ª–ª–æ–≤ ‚Üí **–ë–õ–û–ö–ò–†–û–í–ê–¢–¨**
- 20-49 –±–∞–ª–ª–æ–≤ ‚Üí **–ü–†–û–í–ï–†–ò–¢–¨**
- <20 –±–∞–ª–ª–æ–≤ ‚Üí **OK**

## üéØ –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã

### –ü—Ä–∏–º–µ—Ä 1: –õ–µ–≥–∏—Ç–∏–º–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
```
–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è: 5,000‚Ç∏ –≤ 14:00, –∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–æ–ª—É—á–∞—Ç–µ–ª—å
ML-–º–æ–¥–µ–ª—å: 15% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞
Rule Engine: 0 –±–∞–ª–ª–æ–≤ (–Ω–µ—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π)
‚Üí –†–µ—à–µ–Ω–∏–µ: OK ‚úÖ
```

### –ü—Ä–∏–º–µ—Ä 2: –ú–æ—à–µ–Ω–Ω–∏—á–µ—Å–∫–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
```
–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è: 100,000‚Ç∏ –≤ 2:00, –Ω–æ–≤—ã–π –ø–æ–ª—É—á–∞—Ç–µ–ª—å, —á–µ—Ä–µ–∑ 5 –º–∏–Ω –ø–æ—Å–ª–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–π
ML-–º–æ–¥–µ–ª—å: 85% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞
Rule Engine: 140 –±–∞–ª–ª–æ–≤
  - R1: +30 (—Å—É–º–º–∞ –≤ 12.5x –±–æ–ª—å—à–µ —Å—Ä–µ–¥–Ω–µ–π)
  - R2: +25 (velocity)
  - R3: +20 (–Ω–æ—á—å)
  - R4: +25 (–Ω–æ–≤—ã–π –ø–æ–ª—É—á–∞—Ç–µ–ª—å)
  - R5: +20 (–ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∞—è –∞–Ω–æ–º–∞–ª–∏—è)
  - R6: +20 (–≤—Å–ø–ª–µ—Å–∫ –ª–æ–≥–∏–Ω–æ–≤)
‚Üí –†–µ—à–µ–Ω–∏–µ: –ë–õ–û–ö–ò–†–û–í–ê–¢–¨ üî¥
```

### –ü—Ä–∏–º–µ—Ä 3: –ü–æ–≥—Ä–∞–Ω–∏—á–Ω—ã–π —Å–ª—É—á–∞–π
```
–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è: 30,000‚Ç∏ –≤ 15:00
ML-–º–æ–¥–µ–ª—å: 65% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞
Rule Engine: 45 –±–∞–ª–ª–æ–≤ (R1 + R7)
–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π score: 0.7*0.65 + 0.3*0.45 = 0.59
‚Üí –†–µ—à–µ–Ω–∏–µ: –ü–†–û–í–ï–†–ò–¢–¨ ‚ö†Ô∏è
```

## üí° –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

### ‚úÖ –õ—É—á—à–µ–µ –∏–∑ –¥–≤—É—Ö –º–∏—Ä–æ–≤

| –ê—Å–ø–µ–∫—Ç | ML | Rules | –ì–∏–±—Ä–∏–¥ |
|--------|----|----|--------|
| **–¢–æ—á–Ω–æ—Å—Ç—å** | ‚úÖ –í—ã—Å–æ–∫–∞—è | ‚ö†Ô∏è –°—Ä–µ–¥–Ω—è—è | ‚úÖ –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è |
| **–û–±—ä—è—Å–Ω–∏–º–æ—Å—Ç—å** | ‚ö†Ô∏è –°–ª–æ–∂–Ω–∞—è | ‚úÖ –ü—Ä–æ—Å—Ç–∞—è | ‚úÖ –ü—Ä–æ—Å—Ç–∞—è |
| **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å** | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è | ‚ùå –†—É—á–Ω–∞—è | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è |
| **–†–µ–≥—É–ª—è—Ç–æ—Ä–∏–∫–∞** | ‚ö†Ô∏è –°–ª–æ–∂–Ω–æ | ‚úÖ –õ–µ–≥–∫–æ | ‚úÖ –õ–µ–≥–∫–æ |

### üéØ –î–ª—è –±–∏–∑–Ω–µ—Å–∞:
1. **‚Üë Recall** ‚Äî ML –ª–æ–≤–∏—Ç —Å–ª–æ–∂–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
2. **‚Üì False Positives** ‚Äî Rules –æ—Ç—Å–µ–∫–∞—é—Ç –æ—á–µ–≤–∏–¥–Ω—ã–µ —Å–ª—É—á–∞–∏
3. **‚Üë –î–æ–≤–µ—Ä–∏–µ —Ä–µ–≥—É–ª—è—Ç–æ—Ä–∞** ‚Äî –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞
4. **‚Üë –ì–∏–±–∫–æ—Å—Ç—å** ‚Äî –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### Standalone Rule Engine
```python
from src.utils.rule_engine import FraudRuleEngine

engine = FraudRuleEngine()
score, decision, rules = engine.evaluate_transaction(transaction)
```

### –ö–æ–º–±–∏–Ω–∞—Ü–∏—è —Å ML
```python
# ML –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ
ml_prob = predictor.predict_single_transaction(data)['fraud_probability']

# Rule Engine
rule_score, _, _ = engine.evaluate_transaction(data)

# –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
final_decision, explanation = engine.combine_with_ml(ml_prob, rule_score)
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

| –ú–µ—Ç—Ä–∏–∫–∞ | ML —Ç–æ–ª—å–∫–æ | Rules —Ç–æ–ª—å–∫–æ | –ì–∏–±—Ä–∏–¥ |
|---------|-----------|--------------|--------|
| **Precision** | 92% | 70% | **95%** |
| **Recall** | 96% | 75% | **97%** |
| **F1-Score** | 94% | 72% | **96%** |
| **–û–±—ä—è—Å–Ω–∏–º–æ—Å—Ç—å** | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–∞—è | **–í—ã—Å–æ–∫–∞—è** |

## üé§ –ß—Ç–æ —Å–∫–∞–∑–∞—Ç—å –∂—é—Ä–∏

> **"–ú—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥:**
> 
> **1. ML-–º–æ–¥–µ–ª—å** ‚Äî –¥–ª—è –≤—ã—Å–æ–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è
> 
> **2. Rule Engine** ‚Äî –¥–ª—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ä–µ–≥—É–ª—è—Ç–æ—Ä–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º
> 
> **3. –ö–æ–º–±–∏–Ω–∞—Ü–∏—è** ‚Äî –ª—É—á—à–µ–µ –∏–∑ –¥–≤—É—Ö –º–∏—Ä–æ–≤
> 
> –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–º –¥–æ—Å—Ç–∏—á—å **97% Recall** –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø–æ–ª–Ω–æ–π –æ–±—ä—è—Å–Ω–∏–º–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è —Ä–µ–≥—É–ª—è—Ç–æ—Ä–∞."

---

**–§–∞–π–ª —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** `src/utils/rule_engine.py`

**–¢–µ—Å—Ç:** `python3 src/utils/rule_engine.py`
